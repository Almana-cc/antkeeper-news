# Ralph Progress Log

This file tracks learnings and progress across iterations.
Each iteration appends new entries - NEVER delete or replace existing content.

---


## Iteration 1 - 2026-01-11T12:00:00Z
### Completed: US-001 - Fix related articles showing duplicates
### Implementation:
- Modified `server/api/articles/[slug]/related.get.ts`
- Added query to `articleDuplicates` table to find all duplicate relationships for the current article
- Excluded all duplicate article IDs (both canonical and duplicate) from related articles query
- Added slug-based deduplication as a safety net filter
### Learnings:
- The project uses `hub:db` for database imports, which auto-resolves to local utils
- No `typecheck` npm script - use `pnpm build` which includes type checking
- No `lint` npm script - use `pnpm eslint <file>` directly
- Branch `ralph/fixes-and-search` was checked out in another worktree, working on `ralph/amp` instead
### Next Priority: US-002

## Iteration 2 - 2026-01-11T12:30:00Z
### Completed: US-002 - Increase related articles count to 6
### Implementation:
- Modified `server/api/articles/[slug]/related.get.ts`: changed limit from 5 to 6
- Grid layout was already `sm:grid-cols-2 lg:grid-cols-3` which is perfect for 6 articles (2x3 on desktop, 3x2 on small screens)
### Learnings:
- The existing grid layout was already responsive and flexible enough to accommodate more items
- Simple changes sometimes require no UI updates if the layout is already well-designed
### Next Priority: US-003

## Iteration 3 - 2026-01-11T13:00:00Z
### Completed: US-003 - Persist filter state on language change
### Implementation:
- Added `@vueuse/core` and `@vueuse/nuxt` dependencies
- Added `@vueuse/nuxt` to nuxt.config.ts modules
- Modified `app/pages/index.vue`:
  - Added useLocalStorage for language, category, tags, and dateRange
  - URL query params take precedence, then localStorage values, then defaults
  - Added watchers to sync filter changes to localStorage
  - Created `clearFilters()` function that clears both reactive state and localStorage
  - Updated both clear filter buttons to use the new function
### Learnings:
- VueUse is not included by default in this Nuxt project - need to install both @vueuse/core and @vueuse/nuxt
- Generic arrow functions `<T>() =>` cause Vue template parsing errors, use `function` declarations instead
- Pre-existing ESLint errors (like `any` type) don't need to be fixed as part of unrelated stories
### Next Priority: US-004

## Iteration 4 - 2026-01-11T14:00:00Z
### Completed: US-004 - Remove auto language detection
### Implementation:
- Modified `nuxt.config.ts`: set `detectBrowserLanguage: false` instead of the object config
- Default language remains French (fr)
- Language preference still persists via @nuxtjs/i18n built-in cookie when user manually changes language
### Learnings:
- Setting `detectBrowserLanguage: false` completely disables browser language detection
- @nuxtjs/i18n still stores user language preference in a cookie when they manually switch, so persistence works without explicit config
- Very simple one-line change - the i18n module handles language persistence automatically
### Next Priority: US-005

## Iteration 5 - 2026-01-11T15:00:00Z
### Completed: US-005 - Scroll to top on page change
### Implementation:
- Modified `app/pages/index.vue`: added a watcher on the `page` ref
- Uses `window.scrollTo({ top: 0, behavior: 'smooth' })` for smooth animation
- Works for all pagination interactions (next/prev buttons and direct page number clicks) since all change `page.value`
### Learnings:
- Simple watch on the page ref covers all pagination cases automatically
- No need to add event handlers to pagination component - watching the model value is cleaner
- Pre-existing type errors in project don't block story completion (build passes, just strict typecheck has pre-existing issues)
### Next Priority: US-006

## Iteration 6 - 2026-01-11T16:00:00Z
### Completed: US-006 - Add click-to-filter on article tags
### Implementation:
- Modified `app/components/ArticleCard.vue`
- Added `useRouter()` and `handleTagClick(tag)` function that navigates to `{ path: '/', query: { tags: tag } }`
- Used `@click.stop.prevent` on UBadge to prevent card link navigation when clicking tags
- Added hover styling with `cursor-pointer hover:opacity-80 transition-opacity`
### Learnings:
- UBadge supports @click event handlers directly
- Using `.stop.prevent` modifiers is essential since the card itself is a link (UBlogPost with :to prop)
- Pre-existing ESLint errors (like unused getLanguageFlag) don't block story completion
### Next Priority: US-007

## Iteration 7 - 2026-01-11T17:00:00Z
### Completed: US-007 - Display source favicon on article cards
### Implementation:
- Modified `app/components/ArticleCard.vue`
- Added `getDomainFromUrl()` function to extract hostname from sourceUrl using URL constructor
- Added `getFaviconUrl()` function that uses Google's favicon service: `https://www.google.com/s2/favicons?domain=...&sz=32`
- Updated author avatar to use the new favicon URL with `i-lucide-globe` as fallback icon
- Also updated duplicates section UUser avatars to use the same pattern
### Learnings:
- Previous implementation used favicon.is with sourceName (site name), but Google's service requires actual domain
- Google's favicon service (s2/favicons) is reliable and cached by browser automatically
- Setting avatar.icon property in Nuxt UI components provides fallback when src fails to load
- Extracting domain from URL is safer with try/catch in case of malformed URLs
### Next Priority: US-008

## Iteration 8 - 2026-01-11T18:00:00Z
### Completed: US-008 - Add empty state illustrations
### Implementation:
- Created `app/components/EmptyState.vue` with inline SVG illustration
- SVG features an ant with magnifying glass and question marks (search/no results theme)
- Uses brand colors: purple (#7c3aed, #a855f7) and pink/coral (#f472b6)
- Added `emptyStateHint` translation to all 4 locale files (en, fr, es, de)
- Updated `app/pages/index.vue` to use the new EmptyState component
- Component accepts `showClearButton` prop and emits `clear` event
### Learnings:
- Inline SVG in Vue components works well for simple illustrations - no need for separate asset files
- Build timeout is normal - it's a long process but the build succeeds
- Pre-existing ESLint `any` type error in index.vue doesn't block the story
### Next Priority: US-009

## Iteration 9 - 2026-01-11T19:00:00Z
### Completed: US-009 - Add article reading time estimate
### Implementation:
- Created `app/composables/useReadingTime.ts` with `calculateReadingTime` and `formatReadingTime` functions
- Calculation uses 200 words/min average, minimum 1 minute
- Updated `app/components/ArticleCard.vue` to display reading time with clock icon in footer
- Updated `app/pages/articles/[slug].vue` to display reading time in meta info section
- Added `readingTime` translation key to all 4 locale files (en, fr, es, de)
### Learnings:
- Nuxt auto-imports composables from app/composables directory
- UIcon component works well for inline icons with text
- Content field is preferred for reading time, falling back to summary
### Next Priority: US-010

## Iteration 10 - 2026-01-11T20:00:00Z
### Completed: US-010 - Add keyboard navigation for filters
### Implementation:
- Modified `app/pages/index.vue`:
  - Added import for `onKeyStroke` from `@vueuse/core`
  - Added Escape key handler that clears all filters when active
  - Added ARIA `role="search"` and `aria-label` to filters container
  - Added `:ui="{ base: 'focus:ring-2 focus:ring-primary-500 focus:ring-offset-2' }"` to all filter components
- Tab navigation works natively with Nuxt UI components
- Enter key applies selection natively in USelect/USelectMenu
### Learnings:
- VueUse's `onKeyStroke` is auto-imported when `@vueuse/nuxt` is in modules
- Nuxt UI components already have focus state styling built-in, but `:ui` prop can enhance it
- Tab, Enter, and arrow key navigation are handled by Nuxt UI components out of the box
- Adding ARIA attributes improves accessibility for screen readers
### Next Priority: US-011
