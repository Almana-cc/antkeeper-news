# Ralph Progress Log

This file tracks learnings and progress across iterations.
Each iteration appends new entries - NEVER delete or replace existing content.

---

## Iteration 1 - 2026-01-11T00:00:00Z
### Completed: US-001 - Fix related articles showing duplicates
### Implementation:
- Modified `server/api/articles/[slug]/related.get.ts`
- Added query to `articleDuplicates` table to find all canonical/duplicate relationships
- Used `notInArray` filter to exclude all duplicate article IDs from results
- Removed unused `ne` import to fix lint error
### Learnings:
- The `articleDuplicates` table has bidirectional relationships: an article can be either `canonicalArticleId` or `duplicateArticleId`
- Need to check both fields with `or()` condition when finding duplicates
- This project doesn't have `pnpm typecheck` or `pnpm lint` scripts - use `npx vue-tsc --noEmit` and `npx eslint .` instead
- File paths with brackets need single quotes in bash: `'server/api/articles/[slug]/related.get.ts'`
- `pnpm install` may be needed if node_modules is missing (run `pnpm postinstall` after for Nuxt prepare)
### Next Priority: US-002

## Iteration 2 - 2026-01-11T00:15:00Z
### Completed: US-002 - Increase related articles count to 6
### Implementation:
- Modified `server/api/articles/[slug]/related.get.ts`: Changed limit from 5 to 6
- Grid layout in `app/pages/articles/[slug].vue` already used responsive Tailwind classes (`sm:grid-cols-2 lg:grid-cols-3`) which naturally displays 6 items as 2x3 or 3x2
### Learnings:
- The existing grid layout was already designed to be flexible - always check existing implementation before adding changes
- TypeScript check can be run with `pnpm exec tsc --noEmit` (vue-tsc may not be installed)
- Minimal changes are best - the API limit was the only code change needed
### Next Priority: US-003

## Iteration 3 - 2026-01-11T01:00:00Z
### Completed: US-003 - Persist filter state on language change
### Implementation:
- Installed `@vueuse/nuxt` and `@vueuse/core` packages
- Added `@vueuse/nuxt` to Nuxt modules in `nuxt.config.ts`
- Modified `app/pages/index.vue`:
  - Added `useLocalStorage` for language, category, tags, and dateRange filters
  - URL query params take priority over localStorage values on initial load
  - Added watchers to sync filter changes to localStorage
  - Created `clearFilters()` function that resets both reactive state and localStorage
  - Replaced inline @click handlers with `clearFilters` function calls
### Learnings:
- VueUse requires both `@vueuse/nuxt` module and `@vueuse/core` package
- `useLocalStorage` returns a ref that syncs to localStorage automatically
- When URL params exist, they should override localStorage to support shareable links
- The `filter((t): t is string => t !== null)` type guard is needed to handle nullable LocationQueryValue arrays
- Pre-existing TypeScript errors in other files don't block story completion - focus on new code
- `pnpm exec nuxi typecheck` runs Nuxt's typecheck command
### Next Priority: US-004

## Iteration 4 - 2026-01-11T02:00:00Z
### Completed: US-004 - Remove auto language detection
### Implementation:
- Modified `nuxt.config.ts`: Set `detectBrowserLanguage: false` in i18n configuration
- Previous config had `detectBrowserLanguage` object with useCookie, cookieKey, redirectOn settings
- Now disabled entirely with `false` value
### Learnings:
- @nuxtjs/i18n `detectBrowserLanguage` accepts `false` to completely disable auto-detection
- With `strategy: 'prefix_except_default'`, language preference persists via URL:
  - French (default): no prefix (e.g., `/articles/...`)
  - Other languages: prefixed (e.g., `/en/articles/...`, `/es/articles/...`)
- The language switcher in `app.vue` uses `setLocale()` which handles URL navigation
- Pre-existing TypeScript errors remain (ArticleWithDuplicates types, hub:db:schema module) but don't affect this story
### Next Priority: US-005

