{
  "project": "Antkeeper News",
  "branchName": "ralph/fixes-and-search",
  "description": "Bug fixes, small improvements, and full-text search functionality",
  "userStories": [
    {
      "id": "US-001",
      "title": "Fix related articles showing duplicates",
      "description": "As a user, I want related articles to show unique articles so I don't see the same article multiple times.",
      "acceptanceCriteria": [
        "Related articles API excludes duplicate articles from results",
        "Only unique article slugs appear in related articles section",
        "Duplicate detection considers articleDuplicates table relationships",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Added query to articleDuplicates table to find all canonical/duplicate relationships for the current article, then excludes all related IDs from the related articles query using notInArray"
    },
    {
      "id": "US-002",
      "title": "Increase related articles count to 6",
      "description": "As a user, I want to see 6 related articles instead of 5 for better content discovery.",
      "acceptanceCriteria": [
        "API endpoint returns up to 6 related articles",
        "Grid layout updated to accommodate 6 articles (2x3 or 3x2)",
        "Responsive design maintained on mobile",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Changed API limit from 5 to 6. Grid layout already used responsive classes (sm:grid-cols-2 lg:grid-cols-3) which naturally accommodates 6 articles in a 2x3 or 3x2 layout."
    },
    {
      "id": "US-003",
      "title": "Persist filter state on language change",
      "description": "As a user, I want my filters to persist when I change the site language so I don't lose my selections.",
      "acceptanceCriteria": [
        "Use VueUse useLocalStorage to persist filter state",
        "Category, tags, and date range filters persist across language changes",
        "Filters restore correctly after page reload",
        "Clear filters button also clears localStorage",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Installed @vueuse/nuxt and @vueuse/core. Added useLocalStorage for language, category, tags, and dateRange filters. URL params take priority over localStorage when present. clearFilters() function resets both reactive state and localStorage values."
    },
    {
      "id": "US-004",
      "title": "Remove auto language detection",
      "description": "As a developer, I want to simplify the language selection by removing auto-detection to reduce complexity.",
      "acceptanceCriteria": [
        "Remove detectBrowserLanguage from i18n configuration",
        "Default language is French (fr)",
        "Users must manually select their language",
        "Language preference persists in localStorage/cookie",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Set detectBrowserLanguage: false in nuxt.config.ts i18n section. French remains default locale. Language persists via URL prefix strategy (prefix_except_default) - e.g., /en/, /es/, /de/ for non-French languages."
    },
    {
      "id": "US-005",
      "title": "Scroll to top on page change",
      "description": "As a user, I want the page to scroll to top when I navigate to a different page number.",
      "acceptanceCriteria": [
        "Clicking pagination controls scrolls to top of page",
        "Smooth scroll animation (not jarring jump)",
        "Works on both next/prev and direct page number clicks",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Added watcher on page ref that calls window.scrollTo with behavior:'smooth'. Works for all pagination interactions since they all update the page ref."
    },
    {
      "id": "US-006",
      "title": "Add click-to-filter on article tags",
      "description": "As a user, I want to click on a tag on an article card to filter articles by that tag.",
      "acceptanceCriteria": [
        "Tags on ArticleCard are clickable",
        "Clicking a tag navigates to index with that tag selected",
        "Tag filter is added to URL query params",
        "Works on both index page and article detail page",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": "Added filterByTag function using navigateTo with useLocalePath for i18n support. Tags now have cursor-pointer and hover:opacity-80 styles. Uses @click.stop.prevent on ArticleCard to prevent navigating to article when clicking tag."
    },
    {
      "id": "US-007",
      "title": "Display source favicon on article cards",
      "description": "As a user, I want to see the source website's favicon on article cards for quick visual identification.",
      "acceptanceCriteria": [
        "Fetch favicon from source domain (use favicon service like Google's)",
        "Display 16x16 or 20x20 favicon next to source name",
        "Fallback to generic icon if favicon unavailable",
        "Favicon cached to avoid repeated requests",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": true,
      "notes": "Fixed favicon fetching to extract domain from sourceUrl instead of using sourceName. Uses Google's favicon service (https://www.google.com/s2/favicons?domain=...) which is reliable and handles caching. Added i-lucide-globe as fallback icon. Applied same fix to duplicate article favicons."
    },
    {
      "id": "US-008",
      "title": "Add empty state illustrations",
      "description": "As a user, I want to see friendly illustrations when no articles match my filters.",
      "acceptanceCriteria": [
        "Create or use SVG illustration for empty states",
        "Display when no articles match current filters",
        "Include helpful message suggesting to adjust filters",
        "Matches Antkeeper brand style (purple/coral colors)",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": true,
      "notes": "Created SVG illustration (app/assets/empty-state.svg) featuring magnifying glass with question marks and stylized ant. Uses brand colors: purple (#7c3aed), coral (#f87171), teal (#45bcb4). Added emptyStateHint i18n translations for all 4 languages. Enhanced empty state section with dark mode support."
    },
    {
      "id": "US-009",
      "title": "Add article reading time estimate",
      "description": "As a user, I want to see estimated reading time on articles so I know how long they'll take.",
      "acceptanceCriteria": [
        "Calculate reading time based on content length (avg 200 words/min)",
        "Display reading time on article cards and detail page",
        "Format: '3 min read' or localized equivalent",
        "Add i18n translations for all 4 languages",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": true,
      "notes": "Created useReadingTime composable with getArticleReadingTime function (200 words/min, minimum 1 min). Added reading time display with clock icon to ArticleCard footer and article detail page meta section. Added readingTime i18n key to all 4 locales (fr: 'X min de lecture', en: 'X min read', es: 'X min de lectura', de: 'X Min. Lesezeit')."
    },
    {
      "id": "US-010",
      "title": "Add keyboard navigation for filters",
      "description": "As a user, I want to use keyboard shortcuts to navigate and clear filters for better accessibility.",
      "acceptanceCriteria": [
        "Escape key clears all filters",
        "Tab navigation works through all filter controls",
        "Enter key applies filter selection",
        "Focus states are clearly visible",
        "Typecheck passes"
      ],
      "priority": 10,
      "passes": true,
      "notes": "Added global Escape key handler using onMounted/onUnmounted lifecycle hooks. Created hasActiveFilters() helper function for DRY code. Tab navigation, Enter key selection, and focus states are handled natively by Nuxt UI components (USelect, USelectMenu, UButton)."
    },
    {
      "id": "US-011",
      "title": "Create full-text search database indexes",
      "description": "As a developer, I need PostgreSQL full-text search indexes for efficient article searching.",
      "acceptanceCriteria": [
        "Add tsvector column to articles table for search",
        "Create GIN index on tsvector column",
        "Index includes title, summary, and content fields",
        "Create migration file for schema changes",
        "Add trigger to auto-update tsvector on article insert/update",
        "Typecheck passes"
      ],
      "priority": 11,
      "passes": true,
      "notes": "Created 0006_fulltext_search.sql migration with: search_vector tsvector column, GIN index for efficient queries, trigger function with weighted search (A=title, B=summary, C=content), and backfill query for existing articles. Added custom tsvector type to Drizzle schema since it lacks native support."
    },
    {
      "id": "US-012",
      "title": "Create search API endpoint",
      "description": "As a developer, I need an API endpoint that searches articles using full-text search.",
      "acceptanceCriteria": [
        "Create GET /api/articles/search endpoint",
        "Accept query parameter 'q' for search term",
        "Support language filter parameter",
        "Return ranked results by relevance",
        "Include pagination (limit/offset)",
        "Return highlighted snippets showing matched text",
        "Typecheck passes"
      ],
      "priority": 12,
      "passes": true,
      "notes": "Created GET /api/articles/search.get.ts with: 'q' query param for search, 'language' filter param, ts_rank_cd for relevance ranking, pagination with limit/offset, ts_headline for highlighted snippets in title/summary/content. Uses OR logic between search terms with plainto_tsquery for natural language queries."
    },
    {
      "id": "US-013",
      "title": "Create search input component",
      "description": "As a user, I want a search input in the header to quickly search for articles.",
      "acceptanceCriteria": [
        "Add search input to header/navbar",
        "Search icon button expands to input on click",
        "Input has clear button when text is entered",
        "Submit on Enter key press",
        "Mobile-friendly design (full-width on mobile)",
        "Typecheck passes"
      ],
      "priority": 13,
      "passes": true,
      "notes": "Created SearchInput.vue component with: expandable search on desktop (smooth CSS transition), full-width mobile layout with submit/close buttons, clear button, Enter to submit, Escape to close. Added search i18n keys to all 4 locale files. Integrated into app.vue header."
    },
    {
      "id": "US-014",
      "title": "Create search results page",
      "description": "As a user, I want to see search results on a dedicated page with filtering options.",
      "acceptanceCriteria": [
        "Create /search page with query in URL (?q=term)",
        "Display search results using ArticleCard component",
        "Show number of results found",
        "Include language filter on search results",
        "Handle no results with helpful message",
        "SEO meta tags for search pages",
        "Typecheck passes"
      ],
      "priority": 14,
      "passes": true,
      "notes": "Created app/pages/search.vue with: query from URL (?q=term), ArticleCard grid display, result count with localized singular/plural, language filter dropdown, empty state with illustration and helpful hint, SEO meta tags (title, description, og tags) with noindex to prevent search results from being indexed. Added i18n translations for search page (title, resultsFor, noResultsFor, noResultsHint, resultCount) in all 4 locales."
    },
    {
      "id": "US-015",
      "title": "Add search autocomplete suggestions",
      "description": "As a user, I want to see search suggestions as I type for faster searching.",
      "acceptanceCriteria": [
        "Show dropdown with suggestions as user types",
        "Suggestions based on popular tags and recent searches",
        "Limit to 5-8 suggestions",
        "Keyboard navigation through suggestions (arrow keys)",
        "Debounce input to avoid excessive API calls",
        "Typecheck passes"
      ],
      "priority": 15,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-016",
      "title": "Add search analytics tracking",
      "description": "As a maintainer, I want to track search queries to understand what users are looking for.",
      "acceptanceCriteria": [
        "Create searchQueries table to store search terms",
        "Track query, timestamp, results count, and locale",
        "API endpoint to record searches (fire-and-forget)",
        "Do not store personal identifiable information",
        "Add index on query field for analytics queries",
        "Typecheck passes"
      ],
      "priority": 16,
      "passes": false,
      "notes": ""
    }
  ]
}
